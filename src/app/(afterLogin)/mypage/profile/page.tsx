"use client";

import { getUserInfoApi } from "@/apis/user/userApis";
import Button from "@/components/Button";
import Spinner from "@/components/Spinner";
import { useQuery } from "@tanstack/react-query";

export default function Profile() {
    return (
        <div className="flex flex-col gap-5">
            <ProfileInfo />
            <MyProject />
        </div>
    );
}

const ProfileInfo = () => {
    const { data: user, isPending } = useQuery({
        queryKey: ["isLoggedIn"],
        queryFn: getUserInfoApi,
        refetchInterval: 5 * 60 * 1000, // 5분마다 리페치
    });

    if (isPending) return <Spinner />;
    if (!user) return null;
    return (
        <div className="w-full py-5 px-6 bg-n50 border border-n400 rounded-xl">
            <div className="text-h3 text-n900 mb-4">프로필</div>
            <div className="flex gap-4 items-center">
                <div className="text-smEmphasize text-n900 w-[50px] flex flex-col gap-2">
                    <div>name</div>
                    <div>career</div>
                    <div>job</div>
                    <div>email</div>
                    <div>보유기술</div>
                </div>

                <div className="text-sm text-n800 flex-1 flex flex-col gap-2">
                    <div>{user.name}</div>
                    <div>경력 {user.career || 0}년</div>
                    <div>{user.job || "직업 미정"}</div>
                    <div>{user.email}</div>
                    <div className="flex items-center gap-2">
                        {user.SkillStacks.length > 0 ? (
                            user.SkillStacks.map((v) => {
                                return (
                                    <div key={v.id} className=" py-1.5 px-3 text-taskmateRed text-sm bg-taskmateRed/10 rounded-full">
                                        {v.name}
                                    </div>
                                );
                            })
                        ) : (
                            <div className="text-sm text-n800">보유기술이 없습니다.</div>
                        )}
                    </div>
                </div>
            </div>
        </div>
    );
};

const MyProject = () => {
    const tabs = [
        {
            id: "recruiting",
            title: "모집중 프로젝트",
            count: 0,
            icon: (
                <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M12.5 2.25C10.5716 2.25 8.68657 2.82183 7.08319 3.89317C5.47982 4.96451 4.23013 6.48726 3.49218 8.26884C2.75422 10.0504 2.56114 12.0108 2.93735 13.9021C3.31355 15.7934 4.24215 17.5307 5.60571 18.8943C6.96928 20.2579 8.70656 21.1865 10.5979 21.5627C12.4892 21.9389 14.4496 21.7458 16.2312 21.0078C18.0127 20.2699 19.5355 19.0202 20.6068 17.4168C21.6782 15.8134 22.25 13.9284 22.25 12C22.2473 9.41498 21.2192 6.93661 19.3913 5.10872C17.5634 3.28084 15.085 2.25273 12.5 2.25ZM7.445 18.5156C7.98757 17.6671 8.73501 16.9688 9.61843 16.4851C10.5019 16.0013 11.4928 15.7478 12.5 15.7478C13.5072 15.7478 14.4982 16.0013 15.3816 16.4851C16.265 16.9688 17.0124 17.6671 17.555 18.5156C16.1097 19.6397 14.331 20.2499 12.5 20.2499C10.669 20.2499 8.89032 19.6397 7.445 18.5156ZM9.5 11.25C9.5 10.6567 9.67595 10.0766 10.0056 9.58329C10.3352 9.08994 10.8038 8.70542 11.352 8.47836C11.9001 8.2513 12.5033 8.19189 13.0853 8.30764C13.6672 8.4234 14.2018 8.70912 14.6213 9.12868C15.0409 9.54824 15.3266 10.0828 15.4424 10.6647C15.5581 11.2467 15.4987 11.8499 15.2716 12.3981C15.0446 12.9462 14.6601 13.4148 14.1667 13.7444C13.6734 14.0741 13.0933 14.25 12.5 14.25C11.7044 14.25 10.9413 13.9339 10.3787 13.3713C9.81607 12.8087 9.5 12.0456 9.5 11.25ZM18.665 17.4759C17.8285 16.2638 16.6524 15.3261 15.2844 14.7806C16.0192 14.2019 16.5554 13.4085 16.8184 12.5108C17.0815 11.6132 17.0582 10.6559 16.752 9.77207C16.4457 8.88825 15.8716 8.12183 15.1096 7.5794C14.3475 7.03696 13.4354 6.74548 12.5 6.74548C11.5646 6.74548 10.6525 7.03696 9.89044 7.5794C9.12839 8.12183 8.55432 8.88825 8.24805 9.77207C7.94179 10.6559 7.91855 11.6132 8.18157 12.5108C8.44459 13.4085 8.9808 14.2019 9.71563 14.7806C8.34765 15.3261 7.17147 16.2638 6.335 17.4759C5.27804 16.2873 4.5872 14.8185 4.34567 13.2464C4.10415 11.6743 4.32224 10.0658 4.97368 8.61478C5.62512 7.16372 6.68213 5.93192 8.01745 5.06769C9.35276 4.20346 10.9094 3.74367 12.5 3.74367C14.0906 3.74367 15.6473 4.20346 16.9826 5.06769C18.3179 5.93192 19.3749 7.16372 20.0263 8.61478C20.6778 10.0658 20.8959 11.6743 20.6543 13.2464C20.4128 14.8185 19.722 16.2873 18.665 17.4759Z"
                        fill="#8F95B2"
                    />
                </svg>
            ),
        },
        {
            id: "ongoing",
            title: "진행중 프로젝트",
            count: 0,
            icon: (
                <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M20.75 6.75001H12.8103L10.25 4.18969C10.1112 4.0498 9.94601 3.93889 9.76398 3.86341C9.58196 3.78792 9.38674 3.74938 9.18969 3.75001H4.25C3.85218 3.75001 3.47064 3.90804 3.18934 4.18935C2.90804 4.47065 2.75 4.85218 2.75 5.25001V18.8081C2.7505 19.1904 2.90257 19.5568 3.17286 19.8271C3.44316 20.0974 3.80962 20.2495 4.19188 20.25H20.8334C21.209 20.2495 21.569 20.1001 21.8346 19.8346C22.1001 19.569 22.2495 19.209 22.25 18.8334V8.25001C22.25 7.85218 22.092 7.47065 21.8107 7.18935C21.5294 6.90804 21.1478 6.75001 20.75 6.75001ZM4.25 5.25001H9.18969L10.6897 6.75001H4.25V5.25001ZM20.75 18.75H4.25V8.25001H20.75V18.75Z"
                        fill="#474D66"
                    />
                </svg>
            ),
        },
        {
            id: "completed",
            title: "완료된 프로젝트",
            count: 0,
            icon: (
                <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M16.7806 9.21937C16.8504 9.28903 16.9057 9.37175 16.9434 9.46279C16.9812 9.55384 17.0006 9.65144 17.0006 9.75C17.0006 9.84856 16.9812 9.94616 16.9434 10.0372C16.9057 10.1283 16.8504 10.211 16.7806 10.2806L11.5306 15.5306C11.461 15.6004 11.3783 15.6557 11.2872 15.6934C11.1962 15.7312 11.0986 15.7506 11 15.7506C10.9014 15.7506 10.8038 15.7312 10.7128 15.6934C10.6218 15.6557 10.539 15.6004 10.4694 15.5306L8.21938 13.2806C8.07865 13.1399 7.99959 12.949 7.99959 12.75C7.99959 12.551 8.07865 12.3601 8.21938 12.2194C8.36011 12.0786 8.55098 11.9996 8.75 11.9996C8.94903 11.9996 9.1399 12.0786 9.28063 12.2194L11 13.9397L15.7194 9.21937C15.789 9.14964 15.8718 9.09432 15.9628 9.05658C16.0538 9.01884 16.1514 8.99941 16.25 8.99941C16.3486 8.99941 16.4462 9.01884 16.5372 9.05658C16.6283 9.09432 16.711 9.14964 16.7806 9.21937ZM22.25 12C22.25 13.9284 21.6782 15.8134 20.6068 17.4168C19.5355 19.0202 18.0127 20.2699 16.2312 21.0078C14.4496 21.7458 12.4892 21.9389 10.5979 21.5627C8.70656 21.1865 6.96928 20.2579 5.60571 18.8943C4.24215 17.5307 3.31355 15.7934 2.93735 13.9021C2.56114 12.0108 2.75422 10.0504 3.49218 8.26884C4.23013 6.48726 5.47982 4.96451 7.08319 3.89317C8.68657 2.82183 10.5716 2.25 12.5 2.25C15.085 2.25273 17.5634 3.28084 19.3913 5.10872C21.2192 6.93661 22.2473 9.41498 22.25 12ZM20.75 12C20.75 10.3683 20.2661 8.77325 19.3596 7.41655C18.4531 6.05984 17.1646 5.00242 15.6571 4.37799C14.1497 3.75357 12.4909 3.59019 10.8905 3.90852C9.29017 4.22685 7.82016 5.01259 6.66637 6.16637C5.51259 7.32015 4.72685 8.79016 4.40853 10.3905C4.0902 11.9908 4.25358 13.6496 4.878 15.1571C5.50242 16.6646 6.55984 17.9531 7.91655 18.8596C9.27326 19.7661 10.8683 20.25 12.5 20.25C14.6873 20.2475 16.7843 19.3775 18.3309 17.8309C19.8775 16.2843 20.7475 14.1873 20.75 12Z"
                        fill="#8F95B2"
                    />
                </svg>
            ),
        },
        {
            id: "liked",
            title: "찜한 프로젝트",
            count: 0,
            icon: (
                <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M17.1875 3.75C15.2516 3.75 13.5566 4.5825 12.5 5.98969C11.4434 4.5825 9.74844 3.75 7.8125 3.75C6.27146 3.75174 4.79404 4.36468 3.70436 5.45436C2.61468 6.54404 2.00174 8.02146 2 9.5625C2 16.125 11.7303 21.4369 12.1447 21.6562C12.2539 21.715 12.376 21.7458 12.5 21.7458C12.624 21.7458 12.7461 21.715 12.8553 21.6562C13.2697 21.4369 23 16.125 23 9.5625C22.9983 8.02146 22.3853 6.54404 21.2956 5.45436C20.206 4.36468 18.7285 3.75174 17.1875 3.75ZM12.5 20.1375C10.7881 19.14 3.5 14.5959 3.5 9.5625C3.50149 8.41921 3.95632 7.32317 4.76475 6.51475C5.57317 5.70632 6.66921 5.25149 7.8125 5.25C9.63594 5.25 11.1669 6.22125 11.8062 7.78125C11.8628 7.91881 11.9589 8.03646 12.0824 8.11926C12.2059 8.20207 12.3513 8.24627 12.5 8.24627C12.6487 8.24627 12.7941 8.20207 12.9176 8.11926C13.0411 8.03646 13.1372 7.91881 13.1937 7.78125C13.8331 6.21844 15.3641 5.25 17.1875 5.25C18.3308 5.25149 19.4268 5.70632 20.2353 6.51475C21.0437 7.32317 21.4985 8.41921 21.5 9.5625C21.5 14.5884 14.21 19.1391 12.5 20.1375Z"
                        fill="#8F95B2"
                    />
                </svg>
            ),
        },
    ];

    return (
        <div className="border border-n500 rounded-xl px-6 py-10 bg-white">
            <div className="text-h3 text-n900 mb-8">내 프로젝트</div>
            <div className="grid grid-cols-4 gap-6 mb-[60px]">
                {tabs.map((tab) => {
                    return (
                        <div key={tab.id} className="rounded border border-n400 bg-n0 h-[100px] flex flex-col justify-between cursor-pointer p-[14px]">
                            <div className="flex items-center gap-2 text-n700 text-base leading-7">
                                {tab.icon}
                                {tab.title}
                            </div>
                            <div className="text-lg text-n700 text-end">{tab.count}개</div>
                        </div>
                    );
                })}
            </div>

            <div className="w-full border-t border-n500">
                <div className="w-full flex items-center justify-between border-b border-n500 py-4 pl-6">
                    <div className="text-baseEmphasize text-n900 cursor-pointer">Taskmate</div>
                    <div className="flex items-center gap-2">
                        <Button label="프로젝트 바로가기" size="medium" btnType="line_red" onClick={() => {}} />
                    </div>
                </div>
                <div className="w-full flex items-center justify-between border-b border-n500 py-4 pl-6">
                    <div className="text-baseEmphasize text-n900 cursor-pointer">Taskmate</div>
                    <div className="flex items-center gap-2">
                        <Button label="프로젝트 바로가기" size="medium" btnType="line_red" onClick={() => {}} />
                    </div>
                </div>
            </div>
        </div>
    );
};
